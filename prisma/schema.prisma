// ðŸ”Ÿ Top 10 doctor rating boâ€˜yicha (faqat doctorProfile mavjud va published=true)
async getTopDoctors() {
  // 1. Baholangan doktorlarni olish
  const ratedDoctors = await this.prisma.review.groupBy({
    by: ['doctorId'],
    _avg: { rating: true },
    orderBy: { _avg: { rating: 'desc' } },
    take: 10,
  });

  const ratedDoctorIds = ratedDoctors.map((d) => d.doctorId);

  // 2. Baholangan doktorlarni olish (faqat doctorProfile bor va published=true)
  const ratedDoctorUsers = await this.prisma.user.findMany({
    where: {
      id: { in: ratedDoctorIds },
      role: 'DOCTOR',
      doctorProfile: { isNot: null, published: true },
    },
    include: {
      doctorProfile: {
        include: {
          category: true,
          salary: {
            select: { daily: true, weekly: true, monthly: true, yearly: true },
          },
        },
      },
      reviewsReceived: {
        select: {
          id: true,
          rating: true,
          comment: true,
          createdAt: true,
          user: { select: { id: true, firstName: true, lastName: true } },
        },
      },
    },
  });

  const remainingCount = 10 - ratedDoctorUsers.length;

  // 3. Yetishmagan joyni baholanmagan DOCTOR lar bilan toâ€˜ldirish
  let unratedDoctors: any[] = [];
  if (remainingCount > 0) {
    unratedDoctors = await this.prisma.user.findMany({
      where: {
        role: 'DOCTOR',
        doctorProfile: { isNot: null, published: true }, // ðŸ”¥ faqat doctorProfile bor va published
        NOT: { id: { in: ratedDoctorIds } }, // baholanganlarni chiqarib tashlash
      },
      take: remainingCount,
      orderBy: { createdAt: 'asc' }, // eski roâ€˜yxatdan olish (xohlasa oâ€˜zgartirish mumkin)
      include: {
        doctorProfile: {
          include: {
            category: true,
            salary: {
              select: { daily: true, weekly: true, monthly: true, yearly: true },
            },
          },
        },
        reviewsReceived: {
          select: {
            id: true,
            rating: true,
            comment: true,
            createdAt: true,
            user: { select: { id: true, firstName: true, lastName: true } },
          },
        },
      },
    });
  }

  // 4. Birlashtirib qaytarish
  return [...ratedDoctorUsers, ...unratedDoctors].slice(0, 10);
}
